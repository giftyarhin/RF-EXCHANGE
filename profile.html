<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Profile - RFEX</title>
  <link rel="stylesheet" href="assets/css/styles.css">
  <link rel="stylesheet" href="assets/css/dashboard.css">
  <link rel="stylesheet" href="assets/css/responsive.css">
  <style>
    /* Make date input interactive and visible */
    input[type="date"] {
      position: relative;
      cursor: pointer !important;
    }
    
    input[type="date"]::-webkit-calendar-picker-indicator {
      cursor: pointer;
      filter: invert(0.8);
      font-size: 1.2rem;
      opacity: 0.8;
      transition: opacity 0.3s;
    }
    
    input[type="date"]::-webkit-calendar-picker-indicator:hover {
      opacity: 1;
      filter: invert(1);
    }
    
    input[type="date"]:focus {
      border-color: #FFB703 !important;
      outline: none;
      box-shadow: 0 0 0 2px rgba(255, 183, 3, 0.2);
    }
    
    input[type="date"]:hover {
      border-color: rgba(255, 183, 3, 0.5) !important;
    }
  </style>
</head>
<body class="dashboard-page">
  <header class="dashboard-header">
    <div class="header-inner">
      <button class="nav-toggle" onclick="toggleDashboardNav()" aria-label="Toggle navigation">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      <a class="brand" href="dashboard.html">RFEX</a>
      <nav class="main-nav">
        <a href="dashboard.html">Dashboard</a>
        <a href="markets.html">Markets</a>
        <a href="converter.html">Convert</a>
        <a href="wallets.html">Wallets</a>
        <a href="p2p.html">P2P</a>
        <a href="gift-cards.html">Gift Cards</a>
      </nav>
      <div class="header-actions">
        <button class="notification-btn" onclick="toggleNotifications()" aria-label="Notifications">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          <span class="notification-badge">3</span>
        </button>
        <div class="user-menu">
          <button class="user-btn" onclick="toggleUserMenu()">
            <div class="user-avatar" id="userAvatar">JD</div>
            <span id="userName">John Doe</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="dashboard-main">
    <div class="container">
      <div class="page-header">
        <h1>üë§ Profile</h1>
        <p class="page-subtitle">Manage your account information</p>
        <div style="margin-top: 12px; display: flex; gap: 8px;">
          <button onclick="testSave()" style="padding: 6px 12px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üß™ Test Save Function</button>
          <button onclick="clearAllData()" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üóëÔ∏è Clear All Data</button>
        </div>
      </div>

      <div class="dashboard-grid profile-grid" style="grid-template-columns: 1fr 2fr;">
      <style>
        @media (max-width: 768px) {
          .profile-grid {
            grid-template-columns: 1fr !important;
          }
          .profile-grid > div:first-child {
            order: 1;
          }
        }
      </style>
        <!-- Profile Sidebar -->
        <div class="dashboard-widget">
          <div style="text-align: center; padding: 20px;">
            <div class="user-avatar" id="sidebarAvatar" style="width: 120px; height: 120px; margin: 0 auto 20px; font-size: 3rem;">JD</div>
            <h3 id="sidebarName" style="margin: 0 0 8px 0; color: #F1F5F9;">John Doe</h3>
            <p id="sidebarEmail" style="color: #94A3B8; margin: 0 0 4px 0;">john.doe@example.com</p>
            <p style="color: #10b981; font-size: 0.85rem; margin: 0;"><svg style="width: 14px; height: 14px; vertical-align: middle;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg> Verified</p>
            <button style="margin-top: 20px; background: linear-gradient(135deg, #FFB703, #F59E0B); color: #0F172A; border: none; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">Change Avatar</button>
          </div>
          <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding: 20px;">
            <div style="color: #94A3B8; font-size: 0.85rem; margin-bottom: 8px;">Member Since</div>
            <div style="color: #F1F5F9; font-weight: 600;">January 15, 2026</div>
          </div>
        </div>

        <!-- Profile Details -->
        <div class="dashboard-widget">
          <h3 style="margin: 0 0 24px 0;">Personal Information</h3>
          <form id="profileForm" style="display: grid; gap: 20px;">
            <div>
              <label style="display: block; color: #94A3B8; font-size: 0.9rem; margin-bottom: 8px;">Full Name</label>
              <input type="text" id="fullName" placeholder="Enter your full name" style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.5); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; color: #F1F5F9; font-size: 1rem;">
            </div>
            <div>
              <label style="display: block; color: #94A3B8; font-size: 0.9rem; margin-bottom: 8px;">Email</label>
              <input type="email" id="email" placeholder="your@email.com" style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.5); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; color: #F1F5F9; font-size: 1rem;">
            </div>
            <div>
              <label style="display: block; color: #94A3B8; font-size: 0.9rem; margin-bottom: 8px;">Phone Number</label>
              <input type="tel" id="phone" placeholder="+1 (555) 123-4567" style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.5); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; color: #F1F5F9; font-size: 1rem;">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div>
                <label style="display: block; color: #94A3B8; font-size: 0.9rem; margin-bottom: 8px;">Country</label>
                <select id="country" style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.5); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; color: #F1F5F9; font-size: 1rem;">
                  <option>United States</option>
                  <option>Ghana</option>
                  <option>Nigeria</option>
                  <option>Kenya</option>
                  <option>South Africa</option>
                </select>
              </div>
              <div>
                <label style="display: block; color: #94A3B8; font-size: 0.9rem; margin-bottom: 8px;">Date of Birth</label>
                <div style="display: flex; gap: 8px; align-items: center;">
                  <input 
                    type="date" 
                    id="dob" 
                    max="2026-01-29"
                    min="1900-01-01"
                    placeholder="YYYY-MM-DD"
                    style="flex: 1; padding: 12px; background: rgba(30, 41, 59, 0.9); border: 2px solid rgba(148, 163, 184, 0.3); border-radius: 8px; color: #F1F5F9; font-size: 1rem; cursor: pointer; color-scheme: dark;"
                  >
                  <button 
                    type="button" 
                    onclick="document.getElementById('dob').showPicker(); return false;"
                    style="padding: 12px 16px; background: rgba(255, 183, 3, 0.1); border: 2px solid #FFB703; color: #FFB703; border-radius: 8px; cursor: pointer; font-weight: 600; white-space: nowrap;"
                  >
                    üìÖ Pick Date
                  </button>
                </div>
                <div id="dobDisplay" style="margin-top: 4px; font-size: 0.85rem; color: #10b981;"></div>
              </div>
            </div>
            <div id="saveMessage" style="display: none; padding: 12px; background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; border-radius: 8px; color: #10b981; margin-bottom: 20px;">
              ‚úì Profile saved successfully!
            </div>
            <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 20px; display: flex; gap: 12px; justify-content: flex-end;">
              <button type="button" onclick="cancelChanges()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: #F1F5F9; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">Cancel</button>
              <button type="submit" id="saveBtn" style="background: linear-gradient(135deg, #FFB703, #F59E0B); color: #0F172A; border: none; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>

  <script src="assets/js/dashboard.js"></script>
  <script>
    let formInitialized = false;

    // Load user data from localStorage
    window.addEventListener('DOMContentLoaded', function() {
      console.log('Profile page loaded');
      
      const fullName = localStorage.getItem('userFullName') || '';
      const firstName = localStorage.getItem('userFirstName') || '';
      const lastName = localStorage.getItem('userLastName') || '';
      const email = localStorage.getItem('userEmail') || '';
      const phone = localStorage.getItem('userPhone') || '';
      const country = localStorage.getItem('userCountry') || 'United States';
      const dob = localStorage.getItem('userDOB') || '';
      
      console.log('Loaded data:', { fullName, email, phone, country, dob });
      
      // Update profile sidebar
      if (fullName) {
        const nameParts = fullName.split(' ');
        const initials = nameParts.map(part => part.charAt(0).toUpperCase()).join('').substring(0, 2);
        
        document.getElementById('sidebarAvatar').textContent = initials;
        document.getElementById('sidebarName').textContent = fullName;
        if (document.getElementById('userAvatar')) document.getElementById('userAvatar').textContent = initials;
        if (document.getElementById('userName')) document.getElementById('userName').textContent = fullName;
      }
      
      if (email) {
        document.getElementById('sidebarEmail').textContent = email;
      }
      
      // Update form fields
      if (fullName) document.getElementById('fullName').value = fullName;
      if (email) document.getElementById('email').value = email;
      if (phone) document.getElementById('phone').value = phone;
      document.getElementById('country').value = country;
      if (dob) {
        document.getElementById('dob').value = dob;
        updateDobDisplay(dob);
      }
      
      // Add date change listener
      document.getElementById('dob').addEventListener('change', function() {
        updateDobDisplay(this.value);
      });
      
      // Handle form submission
      const form = document.getElementById('profileForm');
      if (form && !formInitialized) {
        formInitialized = true;
        console.log('Attaching form submit handler');
        
        form.onsubmit = function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          console.log('Form submitted!');
          
          const fullName = document.getElementById('fullName').value.trim();
          const email = document.getElementById('email').value.trim();
          const phone = document.getElementById('phone').value.trim();
          const country = document.getElementById('country').value;
          const dob = document.getElementById('dob').value;
          
          console.log('Saving:', { fullName, email, phone, country, dob });
          
          if (!fullName) {
            alert('‚ö†Ô∏è Please enter your name');
            return false;
          }
          
          if (!email) {
            alert('‚ö†Ô∏è Please enter your email');
            return false;
          }
          
          // Parse full name into first and last name
          const nameParts = fullName.split(' ');
          const firstName = nameParts[0] || '';
          const lastName = nameParts.slice(1).join(' ') || '';
          
          // Save to localStorage
          localStorage.setItem('userFullName', fullName);
          localStorage.setItem('userFirstName', firstName);
          localStorage.setItem('userLastName', lastName);
          localStorage.setItem('userEmail', email);
          localStorage.setItem('userPhone', phone);
          localStorage.setItem('userCountry', country);
          localStorage.setItem('userDOB', dob);
          
          console.log('Saved to localStorage!');
          console.log('Verify saved data:', {
            fullName: localStorage.getItem('userFullName'),
            email: localStorage.getItem('userEmail'),
            dob: localStorage.getItem('userDOB')
          });
          
          // Update sidebar display immediately
          const initials = nameParts.map(part => part.charAt(0).toUpperCase()).join('').substring(0, 2);
          
          document.getElementById('sidebarAvatar').textContent = initials;
          document.getElementById('sidebarName').textContent = fullName;
          document.getElementById('sidebarEmail').textContent = email;
          
          // Update header
          if (document.getElementById('userName')) {
            document.getElementById('userName').textContent = fullName;
            console.log('Updated header name');
          }
          if (document.getElementById('userAvatar')) {
            document.getElementById('userAvatar').textContent = initials;
            console.log('Updated header avatar');
          }
          
          // Show success message
          const saveMessage = document.getElementById('saveMessage');
          if (saveMessage) {
            saveMessage.style.display = 'block';
            setTimeout(() => {
              saveMessage.style.display = 'none';
            }, 5000);
          }
          
          // Change button text temporarily
          const saveBtn = document.getElementById('saveBtn');
          const originalText = saveBtn.textContent;
          saveBtn.textContent = '‚úì Saved!';
          saveBtn.style.background = '#10b981';
          setTimeout(() => {
            saveBtn.textContent = originalText;
            saveBtn.style.background = 'linear-gradient(135deg, #FFB703, #F59E0B)';
          }, 3000);
          
          console.log('‚úì Profile updated successfully!');
          alert('‚úì Profile saved successfully!\n\nName: ' + fullName + '\nEmail: ' + email + (dob ? '\nDate of Birth: ' + dob : ''));
          
          return false;
        };
      }
    });

    function cancelChanges() {
      location.reload();
    }

    function testSave() {
      console.log('Testing save function...');
      const testName = 'Test User ' + Math.floor(Math.random() * 1000);
      const testEmail = 'test' + Math.floor(Math.random() * 1000) + '@example.com';
      
      localStorage.setItem('userFullName', testName);
      localStorage.setItem('userFirstName', testName.split(' ')[0]);
      localStorage.setItem('userLastName', testName.split(' ').slice(1).join(' '));
      localStorage.setItem('userEmail', testEmail);
      
      console.log('Test data saved:', {
        fullName: localStorage.getItem('userFullName'),
        email: localStorage.getItem('userEmail')
      });
      
      alert('‚úì Test data saved!\nName: ' + testName + '\nEmail: ' + testEmail + '\n\nRefreshing page...');
      location.reload();
    }

    function clearAllData() {
      if (confirm('‚ö†Ô∏è This will clear ALL your profile data. Are you sure?')) {
        localStorage.removeItem('userFullName');
        localStorage.removeItem('userFirstName');
        localStorage.removeItem('userLastName');
        localStorage.removeItem('userEmail');
        localStorage.removeItem('userPhone');
        localStorage.removeItem('userCountry');
        localStorage.removeItem('userDOB');
        console.log('All data cleared');
        alert('‚úì All profile data cleared. Refreshing...');
        location.reload();
      }
    }

    function updateDobDisplay(dateValue) {
      if (!dateValue) {
        document.getElementById('dobDisplay').textContent = '';
        return;
      }
      
      const date = new Date(dateValue + 'T00:00:00');
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      const formattedDate = date.toLocaleDateString('en-US', options);
      
      // Calculate age
      const today = new Date();
      let age = today.getFullYear() - date.getFullYear();
      const monthDiff = today.getMonth() - date.getMonth();
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < date.getDate())) {
        age--;
      }
      
      document.getElementById('dobDisplay').textContent = `‚úì Selected: ${formattedDate} (Age: ${age} years)`;
    }
  </script>
</body>
</html>
